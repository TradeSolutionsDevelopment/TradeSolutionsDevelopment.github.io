<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8-bit SHOCK TROOPER ¬∑ Contra‚Äëstyle arcade</title>
    <meta name="description" content="Professional 8-bit run‚Äôn‚Äôgun. Fluid parallax, custom sprites, 3 enemy types, power‚Äëups, particle explosions. Pixel perfect.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        body {
            background: radial-gradient(circle at 20% 30%, #0e1f2a, #071016);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', Courier, monospace;
            padding: 16px;
        }
        .arcade-machine {
            background: #1c3840;
            padding: 25px 30px 30px;
            border-radius: 40px 40px 20px 20px;
            box-shadow: 0 20px 0 #0c1c22, 0 30px 40px rgba(0,0,0,0.8);
            border-bottom: 8px solid #2d5662;
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 8px solid #2e5665;
            border-radius: 16px;
            box-shadow: inset 0 0 0 4px #6d9eb0, 0 10px 0 #142f39;
            width: 800px;
            height: 500px;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
        }
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
            color: #b9f3ff;
            text-shadow: 3px 3px 0 #0f2a30;
            background: #1f424b;
            padding: 12px 30px;
            border-radius: 60px;
            border-bottom: 8px solid #0e262c;
            font-size: 22px;
            font-weight: 900;
            letter-spacing: 3px;
        }
        .score-panel span {
            background: #10262e;
            padding: 8px 24px;
            border-radius: 40px;
            border-bottom: 6px solid #308595;
            color: #fdffb8;
            margin-left: 12px;
        }
        .btn-reset {
            background: #cf4e5c;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 32px;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 8px solid #822c36;
            cursor: pointer;
            transition: 0.06s;
            font-family: 'Courier New', monospace;
            text-shadow: 3px 3px 0 #4e1e24;
            letter-spacing: 4px;
        }
        .btn-reset:hover {
            background: #ec6a7a;
            border-bottom-width: 4px;
            transform: translateY(4px);
        }
        .legend {
            color: #b3ecff;
            font-size: 16px;
            display: flex;
            gap: 32px;
            background: #16353f;
            padding: 8px 24px;
            border-radius: 40px;
            border-bottom: 5px solid #0b1f24;
        }
        .legend i {
            background: #0c2b30;
            padding: 6px 16px;
            border-radius: 30px;
            color: #ffe082;
            font-style: normal;
        }
        .health {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .health span {
            font-size: 28px;
        }
    </style>
</head>
<body>
<div class="arcade-machine">
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    
    <div class="control-panel">
        <div class="score-panel">
            üéØ SCORE <span id="scoreDisplay">00000</span>
        </div>
        <div class="score-panel">
            üèÜ HIGH <span id="highScoreDisplay">00000</span>
        </div>
        <button class="btn-reset" id="restartButton">‚Üª RESTART</button>
    </div>
    <div class="legend">
        <span><i>‚Üê ‚Üí</i> MOVE</span>
        <span><i>‚Üë / SPACE</i> JUMP</span>
        <span><i>Z</i> FIRE  &nbsp;&nbsp; <i>X</i> BOMB</span>
        <div class="health">‚ù§Ô∏è <span id="healthDisplay">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span></div>
    </div>
</div>

<script>
    (function(){
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false; // preserve pixels

        // -------  PIXEL ART SCALING (no blur) -------
        const SCALE = 1; // canvas native 800x500, we draw pixelated

        // -------  GLOBAL STATE -------
        let gameActive = true;
        let gameOver = false;
        let frame = 0;
        let animFrameId = null;
        let lastTimestamp = 0;

        // -------  SCORE & HIGHSCORE (localStorage) -------
        let score = 0;
        let highScore = localStorage.getItem('shockHigh') ? parseInt(localStorage.getItem('shockHigh')) : 0;
        let playerHealth = 6;       // 6 pips = 3 hearts
        const MAX_HEALTH = 6;

        // -------  POWER-UP FLAGS -------
        let rapidFire = false;
        let rapidTimer = 0;

        // -------  PLAYER DIMENSIONS & PHYSICS -------
        const GROUND_Y = 440;
        const PLAYER_WIDTH = 24;
        const PLAYER_HEIGHT = 28;
        const GRAVITY = 0.7;
        const JUMP_FORCE = -12.5;
        const MOVE_SPEED = 4.2;

        let player = {
            x: 140, y: GROUND_Y - PLAYER_HEIGHT,
            vx: 0, vy: 0,
            onGround: false,
            facing: 1,          // 1 = right, -1 = left
            walkCycle: 0,
            shootTimer: 0,
            invincible: 0,
            bombCooldown: 0,
        };

        // -------  PLATFORMS (solid, retro) -------
        const platforms = [
            { x: 220, y: 340, w: 110, h: 12 },
            { x: 480, y: 270, w: 100, h: 12 },
            { x: 60, y: 190, w: 90, h: 12 },
            { x: 610, y: 380, w: 80, h: 12 },
            { x: 350, y: 150, w: 70, h: 12 } // extra platform for verticality
        ];

        // -------  DYNAMIC ENTITIES -------
        let bullets = [];          // player bullets
        let enemies = [];
        let enemyBullets = [];
        let explosions = [];
        let pickups = [];         // health, power

        // -------  ENEMY SPAWN -------
        let spawnTimer = 0;
        const SPAWN_DELAY = 45;

        // -------  PARALLAX BACKGROUND -------
        let bgLayers = [
            { x: 0, speed: 0.2, color1: '#1c4e5a', color2: '#306f7c' }, // far mountains
            { x: 0, speed: 0.6, color1: '#3f7e6b', color2: '#4f9e8a' }, // mid hills
            { x: 0, speed: 1.2, color1: '#6f8c5d', color2: '#5c7449' }  // near foliage
        ];

        // -------  INIT / RESET -------
        function resetGame() {
            gameActive = true;
            gameOver = false;
            score = 0;
            playerHealth = MAX_HEALTH;
            rapidFire = false;
            rapidTimer = 0;

            player = {
                x: 140, y: GROUND_Y - PLAYER_HEIGHT,
                vx: 0, vy: 0,
                onGround: false,
                facing: 1,
                walkCycle: 0,
                shootTimer: 0,
                invincible: 0,
                bombCooldown: 0,
            };

            bullets = [];
            enemies = [];
            enemyBullets = [];
            explosions = [];
            pickups = [];
            spawnTimer = 0;
            updateUI();
        }

        // -------  UI UPDATE (score, health, highscore) -------
        function updateUI() {
            let scr = String(Math.floor(score)).padStart(5, '0');
            document.getElementById('scoreDisplay').innerText = scr;
            let hscr = String(highScore).padStart(5, '0');
            document.getElementById('highScoreDisplay').innerText = hscr;
            // health bar (‚ñà blocks)
            let healthBar = '';
            for (let i=0; i<playerHealth; i++) healthBar += '‚ñà';
            document.getElementById('healthDisplay').innerText = healthBar.padEnd(6, '‚ñë');
        }

        // -------  KEYBOARD (classic arcade) -------
        const keys = {
            left: false, right: false, jump: false, fire: false, bomb: false
        };
        window.addEventListener('keydown', (e) => {
            e.preventDefault();
            switch(e.key) {
                case 'ArrowLeft': keys.left = true; break;
                case 'ArrowRight': keys.right = true; break;
                case 'ArrowUp': case ' ': keys.jump = true; break;
                case 'z': case 'Z': keys.fire = true; break;
                case 'x': case 'X': keys.bomb = true; break;
            }
        });
        window.addEventListener('keyup', (e) => {
            switch(e.key) {
                case 'ArrowLeft': keys.left = false; break;
                case 'ArrowRight': keys.right = false; break;
                case 'ArrowUp': case ' ': keys.jump = false; break;
                case 'z': case 'Z': keys.fire = false; break;
                case 'x': case 'X': keys.bomb = false; break;
            }
        });
        // block arrow scrolling
        window.addEventListener('keydown', (e) => {
            if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key)) e.preventDefault();
        }, false);

        // -------  COLLISION (AABB) -------
        function collides(r1, r2) {
            return r1.x < r2.x + r2.w && r1.x + r1.w > r2.x &&
                   r1.y < r2.y + r2.h && r1.y + r1.h > r2.y;
        }

        // -------  PLAYER UPDATE (PHYSICS, ACTIONS) -------
        function updatePlayer() {
            if (!gameActive) return;
            if (playerHealth <= 0) { gameActive = false; gameOver = true; return; }

            // rapid fire timer
            if (rapidTimer > 0) rapidTimer--;
            else rapidFire = false;

            // horizontal movement
            let accel = 0;
            if (keys.left) accel -= 1;
            if (keys.right) accel += 1;
            player.vx = accel * MOVE_SPEED;
            player.x += player.vx;

            // boundaries
            if (player.x < 10) player.x = 10;
            if (player.x + PLAYER_WIDTH > 790) player.x = 790 - PLAYER_WIDTH;

            // jump
            if (keys.jump && player.onGround) {
                player.vy = JUMP_FORCE;
                player.onGround = false;
            }

            // gravity
            player.vy += GRAVITY;
            player.y += player.vy;

            // ground collision
            player.onGround = false;
            if (player.y + PLAYER_HEIGHT > GROUND_Y) {
                player.y = GROUND_Y - PLAYER_HEIGHT;
                player.vy = 0;
                player.onGround = true;
            }

            // platform collisions (falling only)
            for (let pl of platforms) {
                if (player.vy >= 0) {
                    let bottom = player.y + PLAYER_HEIGHT;
                    let prevBottom = bottom - player.vy;
                    if (prevBottom <= pl.y && bottom >= pl.y &&
                        player.x + PLAYER_WIDTH > pl.x && player.x < pl.x + pl.w) {
                        player.y = pl.y - PLAYER_HEIGHT;
                        player.vy = 0;
                        player.onGround = true;
                    }
                }
            }

            // ceiling
            if (player.y < 30) player.y = 30;

            // facing direction
            if (player.vx > 0.2) player.facing = 1;
            else if (player.vx < -0.2) player.facing = -1;

            // walk animation (leg cycle)
            if (Math.abs(player.vx) > 0.5 && player.onGround) {
                player.walkCycle = (player.walkCycle + 0.25) % 4;
            } else player.walkCycle = 0;

            // shooting
            if (keys.fire && gameActive) {
                let fireRate = rapidFire ? 5 : 14;
                if (player.shootTimer <= 0) {
                    let bulletX = player.facing === 1 ? player.x + PLAYER_WIDTH - 2 : player.x - 10;
                    bullets.push({
                        x: bulletX, y: player.y + PLAYER_HEIGHT/2 - 3,
                        w: 16, h: 6, vx: player.facing * 10, vy: 0,
                    });
                    player.shootTimer = fireRate;
                }
            }
            if (player.shootTimer > 0) player.shootTimer--;

            // BOMB (screen clear, limited)
            if (keys.bomb && player.bombCooldown <= 0 && gameActive) {
                // explosion effect on all enemies
                for (let e of enemies) {
                    explosions.push({ x: e.x + e.w/2, y: e.y + e.h/2, radius: 10, life: 20 });
                    score += e.points;
                }
                enemies = [];
                player.bombCooldown = 180; // 3 seconds
                rapidFire = false; // no bomb spamming
            }
            if (player.bombCooldown > 0) player.bombCooldown--;

            // invincibility
            if (player.invincible > 0) player.invincible--;
        }

        // -------  BULLETS (player) -------
        function updateBullets() {
            for (let i=bullets.length-1; i>=0; i--) {
                let b = bullets[i];
                b.x += b.vx;
                if (b.x > 820 || b.x < -30) { bullets.splice(i,1); continue; }

                // enemy collision
                for (let j=enemies.length-1; j>=0; j--) {
                    let e = enemies[j];
                    if (collides({x:b.x, y:b.y, w:b.w, h:b.h},
                                 {x:e.x, y:e.y, w:e.w, h:e.h})) {
                        bullets.splice(i,1);
                        e.health -= 1;
                        if (e.health <= 0) {
                            score += e.points;
                            if (score > highScore) { highScore = score; localStorage.setItem('shockHigh', highScore); }
                            // explosion
                            explosions.push({ x: e.x + e.w/2, y: e.y + e.h/2, radius: 12, life: 16 });
                            enemies.splice(j,1);
                        }
                        break;
                    }
                }
            }
        }

        // -------  ENEMIES (3 types) -------
        function spawnEnemy() {
            if (!gameActive) return;
            let type = Math.random();
            let enemy;
            if (type < 0.5) { // infantry (ground)
                let yPos = GROUND_Y - 32;
                enemy = {
                    x: 780, y: yPos, w: 26, h: 30,
                    vx: -1.8, health: 1, points: 20,
                    type: 'infantry', frame: 0, shootTimer: 40 + Math.floor(Math.random()*40)
                };
            } else if (type < 0.8) { // heavy (armor)
                let yPos = GROUND_Y - 36;
                enemy = {
                    x: 780, y: yPos, w: 32, h: 34,
                    vx: -1.0, health: 4, points: 70,
                    type: 'heavy', frame: 0, shootTimer: 30
                };
            } else { // drone (fly)
                let yPos = 200 + Math.random() * 180;
                enemy = {
                    x: 780, y: yPos, w: 24, h: 20,
                    vx: -2.2, health: 1, points: 30,
                    type: 'drone', frame: 0, shootTimer: 50
                };
            }
            enemies.push(enemy);
        }

        function updateEnemies() {
            for (let i=enemies.length-1; i>=0; i--) {
                let e = enemies[i];
                e.x += e.vx;
                e.frame = (e.frame + 0.2) % 4;

                if (e.x + e.w < -50) { enemies.splice(i,1); continue; }

                // enemy shooting
                e.shootTimer--;
                if (e.shootTimer <= 0 && gameActive && playerHealth > 0) {
                    let bulletVX = -5.5;
                    if (e.type === 'drone') bulletVX = -6;
                    enemyBullets.push({
                        x: e.x - 8, y: e.y + e.h/2 - 3,
                        w: 12, h: 6, vx: bulletVX, vy: 0
                    });
                    e.shootTimer = e.type === 'heavy' ? 55 : 45;
                }

                // collision with player (damage)
                if (player.invincible <= 0 && gameActive && playerHealth > 0) {
                    if (collides({x:player.x, y:player.y, w:PLAYER_WIDTH, h:PLAYER_HEIGHT},
                                 {x:e.x, y:e.y, w:e.w, h:e.h})) {
                        playerHealth -= (e.type === 'heavy' ? 2 : 1);
                        player.invincible = 70;
                        if (playerHealth < 0) playerHealth = 0;
                        updateUI();
                    }
                }
            }
        }

        // -------  ENEMY BULLETS -------
        function updateEnemyBullets() {
            for (let i=enemyBullets.length-1; i>=0; i--) {
                let eb = enemyBullets[i];
                eb.x += eb.vx;
                if (eb.x < -40) { enemyBullets.splice(i,1); continue; }

                if (player.invincible <= 0 && gameActive && playerHealth > 0) {
                    if (collides({x:player.x, y:player.y, w:PLAYER_WIDTH, h:PLAYER_HEIGHT},
                                 {x:eb.x, y:eb.y, w:eb.w, h:eb.h})) {
                        playerHealth -= 1;
                        player.invincible = 50;
                        enemyBullets.splice(i,1);
                        if (playerHealth < 0) playerHealth = 0;
                        updateUI();
                    }
                }
            }
        }

        // -------  PICKUPS (power-ups) -------
        function spawnPickup(x, y) {
            if (Math.random() < 0.25) { // 25% drop
                pickups.push({
                    x: x, y: y, w: 16, h: 16,
                    type: 'health', vx: -1, life: 300
                });
            }
        }
        function updatePickups() {
            for (let i=pickups.length-1; i>=0; i--) {
                let p = pickups[i];
                p.x += p.vx;
                p.life--;
                if (p.life <= 0 || p.x < -30) { pickups.splice(i,1); continue; }
                if (collides({x:player.x, y:player.y, w:PLAYER_WIDTH, h:PLAYER_HEIGHT},
                             {x:p.x, y:p.y, w:p.w, h:p.h})) {
                    if (p.type === 'health' && playerHealth < MAX_HEALTH) {
                        playerHealth = Math.min(MAX_HEALTH, playerHealth + 2);
                        updateUI();
                    }
                    pickups.splice(i,1);
                }
            }
        }

        // -------  EXPLOSIONS (particle style) -------
        function updateExplosions() {
            for (let i=explosions.length-1; i>=0; i--) {
                let ex = explosions[i];
                ex.life -= 1.5;
                ex.radius += 1.8;
                if (ex.life <= 0) explosions.splice(i,1);
            }
        }

        // -------  RENDERING (professional 8-bit) -------
        function drawParallax() {
            // sky gradient bands
            ctx.fillStyle = '#14323b'; ctx.fillRect(0,0,800,120);
            ctx.fillStyle = '#1d4a55'; ctx.fillRect(0,120,800,70);
            ctx.fillStyle = '#25626b'; ctx.fillRect(0,190,800,60);
            
            // moving layers
            for (let i=0; i<bgLayers.length; i++) {
                let layer = bgLayers[i];
                layer.x -= layer.speed;
                if (layer.x <= -800) layer.x += 800;
                
                ctx.fillStyle = layer.color1;
                for (let j=0; j<3; j++) {
                    let offset = layer.x + j * 800;
                    ctx.beginPath();
                    ctx.moveTo(offset, 300 - i*35);
                    ctx.quadraticCurveTo(offset+200, 200 - i*30, offset+400, 300 - i*35);
                    ctx.lineTo(offset+400, 400);
                    ctx.lineTo(offset, 400);
                    ctx.fillStyle = layer.color1;
                    ctx.fill();
                    ctx.fillStyle = layer.color2;
                    ctx.fillRect(offset+50, 300 - i*32, 40, 40);
                }
            }

            // ground
            ctx.fillStyle = '#4b6a3b'; ctx.fillRect(0, GROUND_Y-6, 800, 20);
            ctx.fillStyle = '#6d8f4d'; ctx.fillRect(0, GROUND_Y-2, 800, 8);
            ctx.fillStyle = '#3b552a'; 
            for (let i=0;i<25;i++) ctx.fillRect(i*36, GROUND_Y-10, 12, 8);
        }

        function drawPlatforms() {
            ctx.shadowBlur = 0;
            platforms.forEach(p => {
                ctx.fillStyle = '#5c4934'; ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.fillStyle = '#846b4a'; ctx.fillRect(p.x+2, p.y-2, p.w-4, 5);
                ctx.fillStyle = '#392e1e'; ctx.fillRect(p.x, p.y+3, p.w, 4);
            });
        }

        function drawPlayerSprite() {
            if (player.invincible % 8 < 4 || player.invincible === 0) {
                let x = player.x, y = player.y;
                // body
                ctx.fillStyle = '#3a7251'; ctx.fillRect(x+2, y+2, 20, 22);
                // head (helmet)
                ctx.fillStyle = '#5a8f4c'; ctx.fillRect(x+6, y-2, 12, 10);
                ctx.fillStyle = '#ab8b3b'; ctx.fillRect(player.facing===1? x+16 : x, y, 8, 6);
                // legs animation
                ctx.fillStyle = '#2b543a';
                if (player.walkCycle < 2) {
                    ctx.fillRect(x+2, y+24, 6, 6); ctx.fillRect(x+14, y+24, 6, 6);
                } else {
                    ctx.fillRect(x+2, y+24, 8, 5); ctx.fillRect(x+14, y+24, 8, 5);
                }
                // gun
                ctx.fillStyle = '#414141';
                if (player.facing === 1) ctx.fillRect(x+20, y+10, 14, 4);
                else ctx.fillRect(x-10, y+10, 14, 4);
            }
        }

        function drawEnemies() {
            enemies.forEach(e => {
                if (e.type === 'infantry') {
                    ctx.fillStyle = '#9d4e3a'; ctx.fillRect(e.x, e.y, e.w, e.h);
                    ctx.fillStyle = '#000'; ctx.fillRect(e.x+4, e.y+6, 4, 4);
                    ctx.fillRect(e.x+14, e.y+6, 4, 4);
                    ctx.fillStyle = '#cec13b'; ctx.fillRect(e.x+8, e.y-3, 8, 6);
                } else if (e.type === 'heavy') {
                    ctx.fillStyle = '#6a4e4e'; ctx.fillRect(e.x, e.y, e.w, e.h);
                    ctx.fillStyle = '#3f2f2f'; ctx.fillRect(e.x+4, e.y+4, 24, 10);
                    ctx.fillStyle = '#c0a050'; ctx.fillRect(e.x+6, e.y-4, 14, 8);
                } else if (e.type === 'drone') {
                    ctx.fillStyle = '#467c7c'; ctx.fillRect(e.x, e.y, e.w, e.h);
                    ctx.fillStyle = '#2d4f4f'; ctx.fillRect(e.x+4, e.y+6, 6, 6);
                    ctx.fillStyle = '#a0d0d0'; ctx.fillRect(e.x+10, e.y-4, 8, 6);
                }
            });
        }

        function drawBulletsAndEffects() {
            bullets.forEach(b => {
                ctx.fillStyle = '#ffd966'; ctx.fillRect(b.x, b.y, b.w, b.h);
                ctx.fillStyle = '#ffbe2e'; ctx.fillRect(b.x-2, b.y+1, 8, 3);
            });
            enemyBullets.forEach(b => {
                ctx.fillStyle = '#ff7474'; ctx.fillRect(b.x, b.y, b.w, b.h);
            });
            explosions.forEach(ex => {
                ctx.fillStyle = `rgba(255, 180, 60, ${ex.life/30})`;
                ctx.beginPath(); ctx.arc(ex.x, ex.y, ex.radius, 0, 2*Math.PI);
                ctx.fill();
            });
            pickups.forEach(p => {
                ctx.fillStyle = '#4caf7a'; ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.fillStyle = 'white'; ctx.font = 'bold 16px monospace';
                ctx.fillText('‚ù§Ô∏è', p.x, p.y+14);
            });
        }

        // -------  GAME LOOP (FRAME) -------
        function gameLoop() {
            if (gameActive) {
                // spawn enemies
                spawnTimer++;
                if (spawnTimer > SPAWN_DELAY && enemies.length < 8) {
                    spawnEnemy();
                    spawnTimer = 0;
                }

                updatePlayer();
                updateBullets();
                updateEnemies();
                updateEnemyBullets();
                updatePickups();
                updateExplosions();

                if (playerHealth <= 0) { gameActive = false; gameOver = true; }
                updateUI();
            }

            // --- DRAW EVERYTHING (clean canvas) ---
            ctx.clearRect(0, 0, 800, 500);
            drawParallax();
            drawPlatforms();
            drawEnemies();
            drawBulletsAndEffects();
            drawPlayerSprite();

            // game over / mission complete
            if (!gameActive) {
                ctx.fillStyle = '#000000aa';
                ctx.fillRect(220, 190, 360, 90);
                ctx.fillStyle = '#ffe98c';
                ctx.font = '36px "Courier New", monospace';
                ctx.textAlign = 'center';
                ctx.fillText(gameOver ? '‚ùå GAME OVER' : 'üèÅ MISSION CLEAR', 400, 245);
            }

            frame++;
            animFrameId = requestAnimationFrame(gameLoop);
        }

        // restart listener
        document.getElementById('restartButton').addEventListener('click', resetGame);

        // start everything
        resetGame();
        gameLoop();

        window.addEventListener('beforeunload', () => cancelAnimationFrame(animFrameId));
    })();
</script>
</body>
</html>
